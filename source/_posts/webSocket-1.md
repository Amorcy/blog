---
title: 浅析WebSocket（一）
tags: [前端, WebSocket]
---
在了解WebSocket之前，我们首先需要知道长连接，短连接，长轮询及短轮询。
- 长连接
在HTTP1.1，请求头中有字段Connection: keep-alive，既表示开启长连接，在开启长连接之后，客户端发送请求，服务端接收请求，双方建立连接，在服务端完成一次请求之后，这个链接不会立马中断，服务端会设置一个时长，在这个时长内，要是客户端再次发起一个请求，那么这个请求不会重新建立一个连接，而是延用之前的连接，跟服务器交互，且在这个请求完成之后服务端会重新开始计时。要是在这个时长内，客户端没有发起请求，那么这个连接会中断，之后的请求会重新建立一个连接。
长连接的有点就在于它减少了连接请求，降低了TCP阻塞，且减少了延迟，实时性比较好。而它的缺点就是它会在完成一次请求之后，保持连接，而有可能这个连接是没必要的从而影响性能，而且如果客户端保持了大量的长连接没有被中断，那么对于后端的负载是相当大的，此时后端人员可以做一些限制，如：限制长连接保持的最大个数、关闭一些长时间没有响应的连接从而避免服务器受损。
---

- 短连接
在HTTP1.0，默认是短连接的。短连接就是指，客户端发起请求，服务端接收请求，两端建立连接，服务端响应资源，连接中断。短连接对于服务器来说管理较为简单，存在的连接都是有用的连接，不需要额外的控制手段。但如果客户请求频繁，将在TCP的建立和关闭操作上浪费较多时间和带宽。
---

- 长轮询
> 长轮询本身不是一种真正的推送技术，它只是传统轮询技术的变种。然而，其能够在真正的推送技术无法实现时模拟推送机制。

在长轮询机制中，客户端像传统轮询一样从服务器请求数据。然而，如果服务器没有可以立即返回给客户端的数据，则不会立刻返回一个空结果，而是保持这个请求等待数据到来（或者恰当的超时），之后将数据作为结果返回给客户端。
轮询的优势是所有浏览器都支持，因为使用XHR对象跟setTimeout()就能实现，我们前端考虑的就是决定什么时候发送请求。
![image](/img/websocket/changlunxun.jpg)

---

- 短轮询
> 短轮询就是服务器立即发送响应，无论数据是否有效。

![image](/img/websocket/duanlunxun.jpg)

---
了解了长连接短连接及长轮询短轮询之后，我们可以看到，前后端通讯只能由前端发起，HTTP无法主动向客户端推送消息。即客户端想要从从服务端获取消息，每次都需要主动发起请求，建立连接从而获取到消息，在一些文字类直播网站（直播吧），如果使用长轮询去获取消息，那对于服务端的荷载是非常大的。
因此我们需要一种只需要建立一次连接之后，服务端便可向客户端主动推送消息的技术来解决，HTTP无法向客户端主动推送消息这一痛点。
基于此WebSocket被发明了出来。



